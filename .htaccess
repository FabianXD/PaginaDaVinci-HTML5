# Apache Server Configs v3.0.0 | MIT License
# https://github.com/h5bp/server-configs-apache

# (!) El uso de archivos `.htaccess` ralentiza Apache, por lo tanto, si tiene
# acceso al archivo de configuración del servidor principal (que generalmente se llama
# `httpd.conf`), deberías agregar esta lógica allí.
#
# https://httpd.apache.org/docs/current/howto/htaccess.html

# ----------------------------------------------------------------------
# | ocultar extensión de página web HTML Y PHP                         |
# ----------------------------------------------------------------------

# líneas de código que quitan las extensiones HTML Y PHP

<IfModule mod_rewrite.c>
    
    RewriteEngine on
    
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.php -f
    RewriteRule ^(.*)$ $1.php
    #RewriteRule ^([a-z]+)/?$ $1.php [NC]
    
    
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.html -f
    RewriteRule ^(.*)$ $1.html
    #RewriteRule ^([a-z]+)/?$ $1.html [NC]
    
</IfModule>

# ######################################################################
# # CROSS-ORIGIN                                                       #
# ######################################################################

# ----------------------------------------------------------------------
# | Solicitudes de origen cruzado                                      |
# ----------------------------------------------------------------------

# Permitir solicitudes de origen cruzado.
#
# https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS
# https://enable-cors.org/
# https://www.w3.org/TR/cors/

# <IfModule mod_headers.c>
#     Header set Access-Control-Allow-Origin "*"
# </IfModule>

# ----------------------------------------------------------------------
# | Imágenes de origen cruzado                                         |
# ----------------------------------------------------------------------

# Envíe el encabezado CORS para las imágenes cuando los navegadores lo soliciten.
#
# https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image
# https://blog.chromium.org/2011/07/using-cross-domain-images-in-webgl-and.html

<IfModule mod_setenvif.c>
    <IfModule mod_headers.c>
        <FilesMatch "\.(bmp|cur|gif|ico|jpe?g|png|svgz?|webp)$">
            SetEnvIf Origin ":" IS_CORS
            Header set Access-Control-Allow-Origin "*" env=IS_CORS
        </FilesMatch>
    </IfModule>
</IfModule>

# ----------------------------------------------------------------------
# | Fuentes web de origen cruzado                                      |
# ----------------------------------------------------------------------

# Permitir el acceso de origen cruzado a las fuentes web.

<IfModule mod_headers.c>
    <FilesMatch "\.(eot|otf|tt[cf]|woff2?)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</IfModule>

# ----------------------------------------------------------------------
# | Tiempo de recursos de origen cruzado                               |
# ----------------------------------------------------------------------

# Permitir el acceso de origen cruzado a la información de tiempo para todos los recursos.
#
# Si un recurso no se sirve con un encabezado `Timing-Allow-Origin` que
# permitiría que su información de sincronización se comparta con el documento,
# algunos de los atributos del objeto `PerformanceResourceTiming`
# establecer en cero.
#
# https://www.w3.org/TR/resource-timing/
# http://www.stevesouders.com/blog/2014/08/21/resource-timing-practical-tips/

# <IfModule mod_headers.c>
#     Header set Timing-Allow-Origin: "*"
# </IfModule>

# ######################################################################
# # ERRORES                                                            #
# ######################################################################

# ----------------------------------------------------------------------
# | Páginas de mensajes de error personalizados                        |
# ----------------------------------------------------------------------

# Personalice lo que Apache devuelve al cliente en caso de error.
# https://httpd.apache.org/docs/current/mod/core.html#errordocument

ErrorDocument 404 /404.html

# ----------------------------------------------------------------------
# | Prevención de errores                                              |
# ----------------------------------------------------------------------

# Deshabilitar la coincidencia de patrones en función de los nombres de archivo.
#
# Esta configuración evita que Apache devuelva un error 404 como resultado
# de una reescritura cuando el directorio con el mismo nombre no existe.
#
# https://httpd.apache.org/docs/current/content-negotiation.html#multiviews

Options -MultiViews

# ######################################################################
# # INTERNET EXPLORER                                                  #
# ######################################################################

# ----------------------------------------------------------------------
# | Modos de documentos                                                |
# ----------------------------------------------------------------------

# Forzar Internet Explorer 8/9/10 para representar páginas en el modo más alto
# disponible en los diversos casos en los que puede que no.
#
# https://hsivonen.fi/doctype/#ie8
#
# (!) Comenzando con Internet Explorer 11, los modos de documento están en desuso.
# Si su empresa todavía depende de aplicaciones y servicios web antiguos que
# diseñado para versiones anteriores de Internet Explorer, es posible que desee
# considere habilitar `Modo de empresa 'en toda su empresa.
#
# https://msdn.microsoft.com/en-us/library/ie/bg182625.aspx#docmode
# https://blogs.msdn.microsoft.com/ie/2014/04/02/stay-up-to-date-with-enterprise-mode-for-internet-explorer-11/

#<IfModule mod_headers.c>
#
#    Header set X-UA-Compatible "IE=edge"
#
#    # `mod_headers` no puede coincidir en función del tipo de contenido, sin embargo,
    # el encabezado de respuesta `X-UA-Compatible` se debe enviar solo para
    # Documentos HTML y no para los demás recursos.

#    <FilesMatch "\.(appcache|atom|bbaw|bmp|br|crx|css|cur|eot|f4[abpv]|flv|geojson|gif|gz|htc|ic[os]|jpe?g|m?js|json(ld)?|m4[av]|manifest|map|markdown|md|mp4|oex|og[agv]|opus|otf|pdf|png|rdf|rss|safariextz|svgz?|swf|topojson|tt[cf]|txt|vcard|vcf|vtt|wasm|webapp|web[mp]|webmanifest|woff2?|xloc|xml|xpi)$">
#        Header unset X-UA-Compatible
#    </FilesMatch>

#</IfModule>

# ----------------------------------------------------------------------
# | Iframes cookies                                                    |
# ----------------------------------------------------------------------

# Permita que las cookies se establezcan desde iframes en Internet Explorer.
#
# https://msdn.microsoft.com/en-us/library/ms537343.aspx
# https://www.w3.org/TR/2000/CR-P3P-20001215/

# <IfModule mod_headers.c>
#     Header set P3P "policyref=\"/w3c/p3p.xml\", CP=\"IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\""
# </IfModule>

# ######################################################################
# # TIPOS DE MEDIOS Y CODIFICACIONES DE CARACTERES                     #
# ######################################################################

# ----------------------------------------------------------------------
# | Tipos de medios                                                    |
# ----------------------------------------------------------------------

# Servir recursos con los tipos de medios adecuados (f.k.a tipos MIME).
#
# https://www.iana.org/assignments/media-types/media-types.xhtml
# https://httpd.apache.org/docs/current/mod/mod_mime.html#addtype

<IfModule mod_mime.c>

  # Data interchange

    AddType application/atom+xml                        atom
    AddType application/json                            json map topojson
    AddType application/ld+json                         jsonld
    AddType application/rss+xml                         rss
    AddType application/vnd.geo+json                    geojson
    AddType application/xml                             rdf xml


  # JavaScript

    # Los servidores deben usar texto / javascript para recursos de JavaScript.
    # https://html.spec.whatwg.org/multipage/scripting.html#scriptingLanguages

    AddType text/javascript                             js mjs


  # Manifest files

    AddType application/manifest+json                   webmanifest
    AddType application/x-web-app-manifest+json         webapp
    AddType text/cache-manifest                         appcache


  # Media files

    AddType audio/mp4                                   f4a f4b m4a
    AddType audio/ogg                                   oga ogg opus
    AddType image/bmp                                   bmp
    AddType image/svg+xml                               svg svgz
    AddType image/webp                                  webp
    AddType video/mp4                                   f4v f4p m4v mp4
    AddType video/ogg                                   ogv
    AddType video/webm                                  webm
    AddType video/x-flv                                 flv

    # Sirviendo archivos de imagen `.ico` con un tipo de medio diferente
    # impide que Internet Explorer los muestre como imágenes:
    # https://github.com/h5bp/html5-boilerplate/commit/37b5fec090d00f38de64b591bcddcb205aadf8ee

    AddType image/x-icon                                cur ico


  # WebAssembly

    AddType application/wasm                            wasm


  # Web fonts

    AddType font/woff                                   woff
    AddType font/woff2                                  woff2
    AddType application/vnd.ms-fontobject               eot
    AddType font/ttf                                    ttf
    AddType font/collection                             ttc
    AddType font/otf                                    otf


  # Other

    AddType application/octet-stream                    safariextz
    AddType application/x-bb-appworld                   bbaw
    AddType application/x-chrome-extension              crx
    AddType application/x-opera-extension               oex
    AddType application/x-xpinstall                     xpi
    AddType text/calendar                               ics
    AddType text/markdown                               markdown md
    AddType text/vcard                                  vcard vcf
    AddType text/vnd.rim.location.xloc                  xloc
    AddType text/vtt                                    vtt
    AddType text/x-component                            htc

</IfModule>

# ----------------------------------------------------------------------
# | Codificaciones de caracteres                                       |
# ----------------------------------------------------------------------

# Sirve todos los recursos etiquetados como `text / html` o` text / plain`
# con el tipo de medio del parámetro `charset` establecido en` UTF-8`.
#
# https://httpd.apache.org/docs/current/mod/core.html#adddefaultcharset

AddDefaultCharset utf-8

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# Sirve los siguientes tipos de archivos con el tipo de medio `charset`
# parámetro establecido en `UTF-8`.
#
# https://httpd.apache.org/docs/current/mod/mod_mime.html#addcharset

<IfModule mod_mime.c>
    AddCharset utf-8 .atom \
                     .bbaw \
                     .css \
                     .geojson \
                     .ics \
                     .js \
                     .json \
                     .jsonld \
                     .manifest \
                     .markdown \
                     .md \
                     .mjs \
                     .rdf \
                     .rss \
                     .topojson \
                     .vtt \
                     .webapp \
                     .webmanifest \
                     .xloc \
                     .xml
</IfModule>

# ######################################################################
# # REESCRIBE                                                          #
# ######################################################################

# ----------------------------------------------------------------------
# | Reescribir el motor                                                |
# ----------------------------------------------------------------------

# (1) Encienda el motor de reescritura (esto es necesario para
# las directivas `RewriteRule` para funcionar).
#
#     https://httpd.apache.org/docs/current/mod/mod_rewrite.html#RewriteEngine
#
# (2) Habilite la opción `FollowSymLinks` si aún no lo está.
#
#     https://httpd.apache.org/docs/current/mod/core.html#options
#
# (3) Si su servidor web no permite la opción `FollowSymlinks`,
# necesita comentarlo o eliminarlo, y luego descomentar
# la línea `Options + SymLinksIfOwnerMatch` (4), pero tenga en cuenta
# del impacto en el rendimiento.
#
#     https://httpd.apache.org/docs/current/misc/perf-tuning.html#symlinks
#
# (4) Algunos servicios de alojamiento en la nube requerirán que establezcas `RewriteBase`.
#
#     https://www.rackspace.com/knowledge_center/frequently-asked-question/why-is-modrewrite-not-working-on-my-site
#     https://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewritebase
#
# (5) Dependiendo de cómo esté configurado su servidor, es posible que también necesite
# usa la directiva `RewriteOptions` para habilitar algunas opciones para
# el motor de reescritura.
#
#     https://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewriteoptions
#
# (6) Configure la variable% {ENV: PROTO}, para permitir que las reescrituras redirijan con el
# esquema apropiado automáticamente (http o https).

#<IfModule mod_rewrite.c>
#
#    # (1)
#    RewriteEngine On
#
#    # (2)
#    Options +FollowSymlinks
#
#    # (3)
#    # Options +SymLinksIfOwnerMatch
#
#    # (4)
#    # RewriteBase /
#
#    # (5)
#    # RewriteOptions <options>
#
#    # (6)
#    RewriteCond %{HTTPS} =on
#    RewriteRule ^ - [env=proto:https]
#    RewriteCond %{HTTPS} !=on
#    RewriteRule ^ - [env=proto:http]
#
#</IfModule>

# ----------------------------------------------------------------------
# | Forzando `https: //`                                               |
# ----------------------------------------------------------------------

# Redirigir de la `http: //` a la versión `https: //` de la URL.
# https://wiki.apache.org/httpd/RewriteHTTPToHTTPS

# <IfModule mod_rewrite.c>
#    RewriteEngine On
#    RewriteCond %{HTTPS} !=on
#    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
# </IfModule>

# ----------------------------------------------------------------------
# | Suprimir el `www.` al comienzo de las URL                          |
# ----------------------------------------------------------------------

# Reescribir www.example.com → example.com

# El mismo contenido nunca debería estar disponible en dos diferentes
# URLs, especialmente no con y sin `www.` al principio.
# Esto puede causar problemas de SEO (contenido duplicado), y por lo tanto,
# debes elegir una de las alternativas y redirigir la otra
# uno.
#
# (!) NUNCA USE AMBAS REGLAS RELACIONADAS CON LA WWW AL MISMO TIEMPO!

# (1) La regla supone por defecto que tanto HTTP como HTTPS
# entornos están disponibles para la redirección.
# Si su certificado SSL no pudo manejar uno de los dominios
# utilizado durante la redirección, debe activar la condición.
#
#https://github.com/h5bp/server-configs-apache/issues/52

#<IfModule mod_rewrite.c>
#    RewriteEngine On
#    # (1)
#    # RewriteCond %{HTTPS} !=on
#    RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
#    RewriteRule ^ %{ENV:PROTO}://%1%{REQUEST_URI} [R=301,L]
#</IfModule>

# ----------------------------------------------------------------------
# | Forzar el `www.` al comienzo de las URL                            |
# ----------------------------------------------------------------------

# Reescribir example.com → www.example.com

# El mismo contenido nunca debería estar disponible en dos diferentes
# URLs, especialmente no con y sin `www.` al principio.
# Esto puede causar problemas de SEO (contenido duplicado), y por lo tanto,
# debes elegir una de las alternativas y redirigir la otra
# uno.
#
# (!) NUNCA USE AMBAS REGLAS RELACIONADAS CON LA WWW AL MISMO TIEMPO!

# (1) La regla supone por defecto que tanto HTTP como HTTPS
# entornos están disponibles para la redirección.
# Si su certificado SSL no pudo manejar uno de los dominios
# utilizado durante la redirección, debe activar la condición.
#
#     https://github.com/h5bp/server-configs-apache/issues/52

# Tenga en cuenta que lo siguiente puede no ser una buena idea si usa "real"
# subdominios para ciertas partes de su sitio web.

# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     # (1)
#     # RewriteCond %{HTTPS} !=on
#     RewriteCond %{HTTP_HOST} !^www\. [NC]
#     RewriteCond %{SERVER_ADDR} !=127.0.0.1
#     RewriteCond %{SERVER_ADDR} !=::1
#     RewriteRule ^ %{ENV:PROTO}://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
# </IfModule>

# ######################################################################
# # SEGURIDAD                                                          #
# ######################################################################

# ----------------------------------------------------------------------
# | Clickjacking                                                       |
# ----------------------------------------------------------------------

# Proteger el sitio web contra clickjacking.
#
# El siguiente ejemplo envía el encabezado de respuesta `X-Frame-Options` con
# el valor 'DENY', que informa a los navegadores que no muestren el contenido de
# la página web en cualquier marco.
#
# Esta podría no ser la mejor opción para todos. Debes leer
# sobre los otros dos valores posibles el encabezado `X-Frame-Options`
# field puede tener: `SAMEORIGIN` y` ALLOW-FROM`.
# https://tools.ietf.org/html/rfc7034#section-2.1.
#
# Tenga en cuenta que si bien puede enviar el encabezado `X-Frame-Options`
# para todas las páginas de su sitio web, esto tiene el potencial inconveniente de
# prohíbe incluso el encuadre no malicioso de su contenido (por ejemplo, cuando
# usuarios visitan su sitio web usando una página de resultados de búsqueda de imágenes de Google).
#
# No obstante, debe asegurarse de enviar las `Opciones de X-Frame`
# encabezado para todas las páginas que permiten a un usuario hacer un cambio de estado
# operación (por ejemplo, páginas que contienen vínculos de compra con un solo clic, pago y envío
# o páginas de confirmación de transferencia bancaria, páginas que hacen permanente
# cambios de configuración, etc.).
#
# El envío del encabezado `X-Frame-Options` también puede proteger su sitio web
# contra algo más que ataques de clickjacking:
# https://cure53.de/xfo-clickjacking.pdf.
#
# https://tools.ietf.org/html/rfc7034
# https://blogs.msdn.microsoft.com/ieinternals/2010/03/30/combating-clickjacking-with-x-frame-options/
# https://www.owasp.org/index.php/Clickjacking

# <IfModule mod_headers.c>

# Encabezado establece X-Frame-Options "DENY"

# # `mod_headers` no puede coincidir en función del tipo de contenido, sin embargo,
# # el encabezado de respuesta `X-Frame-Options` debe enviarse solo para
# # Documentos HTML y no para los demás recursos.

#     <FilesMatch "\.(appcache|atom|bbaw|bmp|br|crx|css|cur|eot|f4[abpv]|flv|geojson|gif|gz|htc|ic[os]|jpe?g|m?js|json(ld)?|m4[av]|manifest|map|markdown|md|mp4|oex|og[agv]|opus|otf|pdf|png|rdf|rss|safariextz|svgz?|swf|topojson|tt[cf]|txt|vcard|vcf|vtt|wasm|webapp|web[mp]|webmanifest|woff2?|xloc|xml|xpi)$">
#         Header unset X-Frame-Options
#     </FilesMatch>

# </IfModule>

# ----------------------------------------------------------------------
# | Política de seguridad de contenido (CSP)                           |
# ----------------------------------------------------------------------

# Mitigar el riesgo de secuencias de comandos entre sitios y otra inyección de contenido
# ataques.
#
# Esto se puede hacer configurando una `Política de seguridad de contenido` que
# incluye en la lista de búsqueda fuentes confiables de contenido para su sitio web.
#
# El encabezado de ejemplo a continuación permite SÓLO secuencias de comandos que se cargan desde
# el origen del sitio web actual (sin secuencias de comandos en línea, sin CDN, etc.).
# ¡Es casi seguro que no funcionará como está para su sitio web!
#
# Para facilitar las cosas, puede usar un generador de encabezado CSP en línea
# como: http://cspisawesome.com/.
#
# https://content-security-policy.com/
# https://www.html5rocks.com/en/tutorials/security/content-security-policy/
# https://w3c.github.io/webappsec-csp/

# <IfModule mod_headers.c>

# Encabezado establecido Content-Security-Policy "script-src 'self'; object-src 'self'"

# # `mod_headers` no puede coincidir en función del tipo de contenido, sin embargo,
# # se debe enviar el encabezado de respuesta `Content-Security-Policy`
# # solo para documentos HTML y no para los otros recursos.

#     <FilesMatch "\.(appcache|atom|bbaw|bmp|br|crx|css|cur|eot|f4[abpv]|flv|geojson|gif|gz|htc|ic[os]|jpe?g|m?js|json(ld)?|m4[av]|manifest|map|markdown|md|mp4|oex|og[agv]|opus|otf|pdf|png|rdf|rss|safariextz|svgz?|swf|topojson|tt[cf]|txt|vcard|vcf|vtt|wasm|webapp|web[mp]|webmanifest|woff2?|xloc|xml|xpi)$">
#         Header unset Content-Security-Policy
#     </FilesMatch>

# </IfModule>

# ----------------------------------------------------------------------
# | Acceso a archivos                                                  |
# ----------------------------------------------------------------------

# Bloquear el acceso a los directorios sin un documento predeterminado.
#
# Debe dejar lo siguiente sin comentar, ya que no debe permitir
# a cualquiera que navegue por todos los directorios de su servidor (que puede
# incluye lugares bastante privados, como los directorios del CMS).

<IfModule mod_autoindex.c>
    Options -Indexes
</IfModule>

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# Bloquea el acceso a todos los archivos y directorios ocultos con la excepción de
# el contenido visible desde el directorio oculto `/ .well-known /`.
#
# Estos tipos de archivos generalmente contienen preferencias del usuario o
# estado de una utilidad, y puede incluir lugares más bien privados como, por
# ejemplo, los directorios `.git` o` .svn`.
#
# El directorio `/ .well-known /` representa la ruta estándar (RFC 5785)
# prefijo para "ubicaciones conocidas" (p. ej .: `/ .well-known / manifest.json`,
# `/ .well-known / keybase.txt`), y por lo tanto, el acceso a su visible
# contenido no debe ser bloqueado.
#
# https://www.mnot.net/blog/2010/04/07/well-known
# https://tools.ietf.org/html/rfc5785

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_URI} "!(^|/)\.well-known/([^./]+./?)+$" [NC]
    RewriteCond %{SCRIPT_FILENAME} -d [OR]
    RewriteCond %{SCRIPT_FILENAME} -f
    RewriteRule "(^|/)\." - [F]
</IfModule>

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# Bloquea el acceso a los archivos que pueden exponer información confidencial.
#
# De forma predeterminada, bloquear el acceso a la copia de seguridad y los archivos de origen que pueden ser
# dejado por algunos editores de texto y puede suponer un riesgo de seguridad cuando alguien
# tiene acceso a ellos.
#
# https://feross.org/cmsploit/
#
# (!) Actualice la expresión regular `<FilesMatch>` de abajo a
# incluye cualquier archivo que pueda terminar en su servidor de producción y
# puede exponer información confidencial sobre su sitio web. Estos archivos pueden
# include: archivos de configuración, archivos que contienen metadatos sobre
# proyecto (por ejemplo, dependencias del proyecto), scripts de compilación, etc.

<IfModule mod_authz_core.c>
    <FilesMatch "(^#.*#|\.(bak|conf|dist|fla|in[ci]|log|orig|psd|sh|sql|sw[op])|~)$">
        Require all denied
    </FilesMatch>
</IfModule>

# ----------------------------------------------------------------------
# | Seguridad de transporte estricta de HTTP (HTTS)                    |
# ----------------------------------------------------------------------

# Forzar la redirección SSL del lado del cliente.
#
# Si un usuario escribe `example.com` en su navegador, incluso si el servidor
# los redirecciona a la versión segura del sitio web, que aún se va
# una ventana de oportunidad (la conexión HTTP inicial) para un atacante
# para degradar o redirigir la solicitud.
#
# El siguiente encabezado asegura que el navegador SOLO se conectará a su
# servidor a través de HTTPS, independientemente de lo que escriban los usuarios en el navegador
# Barra de dirección.
#
# (!) Tenga en cuenta que esto, una vez publicado, no es revocable y debe asegurarse
# ser capaz de servir el sitio a través de SSL por la duración que ha especificado
# en max-age. Cuando no tiene una conexión SSL válida (más) su
# visitantes verán un desagradable mensaje de error incluso cuando intenten conectarse
# a través de HTTP simple.
#
# (!) Elimina la directiva opcional `includeSubDomains` si el sitio web
# subdominios no usan HTTPS.
#
# (1) Si desea enviar su sitio para la precarga de HSTS (2) debe
# * asegurar que la directiva `includeSubDomains` esté presente
# * la directiva `preload` a ser especificada
# * la `max-age` es al menos 31536000 segundos (1 año) según el estado actual.
#
# También se recomienda (3) que solo sirva el encabezado HSTS a través de una conexión segura
# que se puede hacer con `env = https` o` "expr =% {HTTPS} == 'on'" `(4). los
# La forma exacta depende de tu entorno y podría intentarlo.
#
# https://www.html5rocks.com/en/tutorials/security/transport-layer-security/
# https://tools.ietf.org/html/rfc6797#section-6.1
# https://blogs.msdn.microsoft.com/ieinternals/2014/08/18/strict-transport-security/
# (2) https://hstspreload.org/
# (3) https://tools.ietf.org/html/rfc6797#section-7.2
# (4) https://stackoverflow.com/questions/24144552/how-to-set-hsts-header-from-htaccess-only-on-https/24145033#comment81632711_24145033

# <IfModule mod_headers.c>
#     Header always set Strict-Transport-Security "max-age=16070400; includeSubDomains"
#     # (1) or if HSTS preloading is desired (respect (2) for current requirements):
#     # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS
#     # (4) respectively… (respect (2) for current requirements):
#     # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" "expr=%{HTTPS} == 'on'"
# </IfModule>

# ----------------------------------------------------------------------
# | Reducir los riesgos de seguridad del tipo MIME                     |
# ----------------------------------------------------------------------

# Impedir que algunos navegadores MIME detecten la respuesta.
#
# Esto reduce la exposición a ataques de descarga drive-by y origen cruzado
# pérdidas de datos, y deben dejarse sin comentarios, especialmente si el servidor
# está publicando contenido subido por el usuario o contenido que podría ser potencialmente
# tratado como ejecutable por el navegador.
#
# https://www.slideshare.net/hasegawayosuke/owasp-hasegawa
# https://blogs.msdn.microsoft.com/ie/2008/07/02/ie8-security-part-v-comprehensive-protection/
# https://msdn.microsoft.com/en-us/library/ie/gg622941.aspx
# https://mimesniff.spec.whatwg.org/

<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
</IfModule>

# ----------------------------------------------------------------------
# | Reflejos reflejados en scripts de sitios (XSS)                     |
# ----------------------------------------------------------------------

# (1) Intente volver a habilitar el filtro de secuencias de comandos entre sitios (XSS) creado
# en la mayoría de los navegadores web.
#
# El filtro generalmente está habilitado por defecto, pero en algunos casos
# puede ser deshabilitado por el usuario. Sin embargo, en Internet Explorer para
# ejemplo, se puede volver a habilitar simplemente enviando el
# Encabezado `X-XSS-Protection` con el valor de` 1`.
#
# (2) Evite que los navegadores web visualicen la página web si existe un potencial
# reflejado (a.k.a no persistente) el ataque XSS es detectado por el
# filtro.
#
# Por defecto, si el filtro está habilitado y los navegadores detectan un
# reflejo del ataque XSS, intentarán bloquear el ataque
# haciendo las modificaciones más pequeñas posibles a la devolución
# página web.
#
# Desafortunadamente, en algunos navegadores (por ejemplo: Internet Explorer),
# este comportamiento predeterminado puede permitir que el filtro XSS sea explotado,
# por lo tanto, es mejor informar a los navegadores para evitar la representación
# de la página en total, en lugar de intentar modificarlo.
#
# https://hackademix.net/2009/11/21/ies-xss-filter-creates-xss-vulnerabilities
#
# (!) No confíe en el filtro XSS para evitar ataques XSS. Asegurarse de que
# está tomando todas las medidas posibles para evitar los ataques XSS,
# El ser más obvio: validar y desinfectar las entradas de su sitio web.
#
# https://blogs.msdn.microsoft.com/ie/2008/07/02/ie8-security-part-iv-the-xss-filter/
# https://blogs.msdn.microsoft.com/ieinternals/2011/01/31/controlling-the-xss-filter/
# https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29

# <IfModule mod_headers.c>

#     #                           (1)    (2)
#     Header set X-XSS-Protection "1; mode=block"

# # `mod_headers` no puede coincidir en función del tipo de contenido, sin embargo,
# # el encabezado de respuesta `X-XSS-Protection` debe enviarse solo para
# # Documentos HTML y no para los demás recursos.

#     <FilesMatch "\.(appcache|atom|bbaw|bmp|br|crx|css|cur|eot|f4[abpv]|flv|geojson|gif|gz|htc|ic[os]|jpe?g|m?js|json(ld)?|m4[av]|manifest|map|markdown|md|mp4|oex|og[agv]|opus|otf|pdf|png|rdf|rss|safariextz|svgz?|swf|topojson|tt[cf]|txt|vcard|vcf|vtt|wasm|webapp|web[mp]|webmanifest|woff2?|xloc|xml|xpi)$">
#         Header unset X-XSS-Protection
#     </FilesMatch>

# </IfModule>

# ----------------------------------------------------------------------
# | Política de referencia                                             |
# ----------------------------------------------------------------------

# Una aplicación web utiliza HTTPS y un identificador de sesión basado en URL.
# La aplicación web podría querer vincular a recursos HTTPS en otra
# sitios web sin filtrar el identificador de sesión del usuario en la URL.
#
# Esto se puede hacer configurando una `Política de referencia` que
# incluye en la lista de búsqueda fuentes confiables de contenido para su sitio web.
#
# Para verificar su política de referencia, puede usar un servicio en línea
# como: https://securityheaders.io/.
#
# https://scotthelme.co.uk/a-new-security-header-referrer-policy/
# https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy

# <IfModule mod_headers.c>

# # no-referrer-when-downgrade (predeterminado)
# # Este debería ser el comportamiento predeterminado del agente de usuario si no hay una política
# # especificado. El origen se envía como referente a a-priori como-mucho-seguro
# # destino (HTTPS-> HTTPS), pero no se envía a un destino menos seguro
# # (HTTPS-> HTTP).

# Encabezado establecido Referrer-Policy "no-referrer-when-downgrade"

# # `mod_headers` no puede coincidir en función del tipo de contenido, sin embargo,
# # se debe enviar el encabezado de respuesta `Referrer-Policy`
# # solo para documentos HTML y no para los otros recursos.

#     <FilesMatch "\.(appcache|atom|bbaw|bmp|br|crx|css|cur|eot|f4[abpv]|flv|geojson|gif|gz|htc|ic[os]|jpe?g|m?js|json(ld)?|m4[av]|manifest|map|markdown|md|mp4|oex|og[agv]|opus|otf|pdf|png|rdf|rss|safariextz|svgz?|swf|topojson|tt[cf]|txt|vcard|vcf|vtt|wasm|webapp|web[mp]|webmanifest|woff2?|xloc|xml|xpi)$">
#         Header unset Referrer-Policy
#     </FilesMatch>

# </IfModule>

# ----------------------------------------------------------------------
# | Información de tecnología del lado del servidor                    |
# ----------------------------------------------------------------------

# Eliminar el encabezado de respuesta `X-Powered-By` que:
#
# * está establecido por algunos marcos y lenguajes del lado del servidor
# (por ejemplo, ASP.NET, PHP) y su valor contiene información
# sobre ellos (por ejemplo, su nombre, número de versión)
#
# * no proporciona ningún valor a los usuarios, contribuye al encabezado
# inflado, y en algunos casos, la información que proporciona puede
# exponer vulnerabilidades
#
# (!) Si puede, debe desactivar el encabezado `X-Powered-By` del
# language / framework level (por ejemplo, para PHP, puede hacer eso configurando
# `expose_php = off` en` php.ini`)
#
# https://php.net/manual/en/ini.core.php#ini.expose-php

<IfModule mod_headers.c>
    Header unset X-Powered-By
</IfModule>

# ----------------------------------------------------------------------
# | Información del software del servidor                              |
# ----------------------------------------------------------------------

# Impedir que Apache agregue una línea de pie de página posterior que contiene
# información sobre el servidor a los documentos generados por el servidor
# (por ejemplo, mensajes de error, listados de directorios, etc.)
#
# https://httpd.apache.org/docs/current/mod/core.html#serversignature

ServerSignature Off

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# Impedir que Apache envíe el encabezado de respuesta del `Servidor`
# número de versión exacta, la descripción del tipo de sistema operativo genérico o
# información sobre sus módulos compilados.
#
# (!) La directiva `ServerTokens` solo funcionará en el servidor principal
# archivo de configuración, ¡así que no intente habilitarlo en el archivo `.htaccess`!
#
# https://httpd.apache.org/docs/current/mod/core.html#servertokens

#ServerTokens Prod

# ######################################################################
# # RENDIMIENTO WEB                                                    #
# ######################################################################

# ----------------------------------------------------------------------
# | Compresión                                                        |
# ----------------------------------------------------------------------

<IfModule mod_deflate.c>

    # Forzar compresión para encabezados de solicitud `Accept-Encoding` mutilados
    # https://developer.yahoo.com/blogs/ydn/pushing-beyond-gzipping-25601.html

    <IfModule mod_setenvif.c>
        <IfModule mod_headers.c>
            SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s*,?\s*)+|[X~-]{4,13}$ HAVE_Accept-Encoding
            RequestHeader append Accept-Encoding "gzip,deflate" env=HAVE_Accept-Encoding
        </IfModule>
    </IfModule>

    # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

    # Comprimir todos los resultados etiquetados con uno de los siguientes tipos de medios.
    # https://httpd.apache.org/docs/current/mod/mod_filter.html#addoutputfilterbytype

    <IfModule mod_filter.c>
        AddOutputFilterByType DEFLATE 
        "application/atom+xml" \
        "application/javascript" \
        "application/json" \
        "application/ld+json" \
        "application/manifest+json" \
        "application/rdf+xml" \
        "application/rss+xml" \
        "application/schema+json" \
        "application/vnd.geo+json" \
        "application/vnd.ms-fontobject" \
        "application/wasm" \
        "application/x-font-ttf" \
        "application/x-javascript" \
        "application/x-web-app-manifest+json" \
        "application/xhtml+xml" \
        "application/xml" \
        "font/collection" \
        "font/eot" \
        "font/opentype" \
        "font/otf" \
        "font/ttf" \
        "image/bmp" \
        "image/svg+xml" \
        "image/vnd.microsoft.icon" \
        "image/x-icon" \
        "text/cache-manifest" \
        "text/calendar" \
        "text/css" \
        "text/html" \
        "text/javascript" \
        "text/plain" \
        "text/markdown" \
        "text/vcard" \
        "text/vnd.rim.location.xloc" \
        "text/vtt" \
        "text/x-component" \
        "text/x-cross-domain-policy" \
        "text/xml"
    </IfModule>

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# Asignar las siguientes extensiones de nombre de archivo a la especificada
# tipo de codificación para hacer que Apache sirva los tipos de archivos
# con el encabezado de respuesta `Content-Encoding` apropiado
# (¡tenga en cuenta que esto NO hará que Apache los comprima!).
#
# Si estos tipos de archivos se publicarían sin un apropiado
# Encabezado de respuesta `Content-Enable`, aplicaciones de cliente (por ejemplo:
# browsers) no sabría que primero necesitan descomprimir
# la respuesta, y por lo tanto, no sería capaz de entender la
# contenido.
#
# https://httpd.apache.org/docs/current/mod/mod_mime.html#addencoding

    <IfModule mod_mime.c>
        AddEncoding gzip              svgz
    </IfModule>

</IfModule>

# ----------------------------------------------------------------------
# | Contenido precomprimido de Brotli                                  |
# ----------------------------------------------------------------------

# Sirve archivos comprimidos de brotli CSS, JS, HTML, SVG, ICS y JSON
# si existen y si el cliente acepta la codificación br.
#
# (!) Para que esta parte sea relevante, debe generar codificada
# archivos por su cuenta. Habilitar esta parte no se generará automáticamente
# archivos borrados
#
# https://httpd.apache.org/docs/current/mod/mod_brotli.html#precompressed

# <IfModule mod_headers.c>

#     RewriteCond %{HTTP:Accept-Encoding} br
#     RewriteCond %{REQUEST_FILENAME}\.br -f
#     RewriteRule \.(css|ics|js|json|html|svg)$ %{REQUEST_URI}.br [L]

#     # Prevent mod_deflate double gzip
#     RewriteRule \.br$ - [E=no-gzip:1]

#     <FilesMatch "\.br$">

#         <IfModule mod_mime.c>
#             # Serve correct content types
#             AddType text/css              css.br
#             AddType text/calendar         ics.br
#             AddType text/javascript       js.br
#             AddType application/json      json.br
#             AddType text/html             html.br
#             AddType image/svg+xml         svg.br

#             # Serve correct content charset
#             AddCharset utf-8 .css.br \
#                              .ics.br \
#                              .js.br \
#                              .json.br
#         </IfModule>

# # Forzar proxies para almacenar en caché los archivos brotlied y no brotlied por separado
# # Encabezado anexar Variar Aceptar-Codificar

#     </FilesMatch>

#     # Serve correct encoding type
#     AddEncoding br .br

# </IfModule>

# ----------------------------------------------------------------------
# | Contenido precomprimido de GZip                                    |
# ----------------------------------------------------------------------

# Sirve archivos CSS comprimidos gzip, JS, HTML, SVG, ICS y JSON
# si existen y si el cliente acepta la codificación gzip.
#
# (!) Para que esta parte sea relevante, debe generar codificada
# archivos por su cuenta. Habilitar esta parte no se generará automáticamente
# archivos gziped.
#
# https://httpd.apache.org/docs/current/mod/mod_deflate.html#precompressed
#
# (1)
# Eliminación del tipo MIME predeterminado para archivos .gz que permite agregar personalizado
# subtipos.
# Puede preferir utilizar extensiones menos genéricas como .html_gz en
# orden para mantener el comportamiento predeterminado con respecto a los archivos .gz.
# https://httpd.apache.org/docs/current/mod/mod_mime.html#removetype

# <IfModule mod_headers.c>

#     RewriteCond %{HTTP:Accept-Encoding} gzip
#     RewriteCond %{REQUEST_FILENAME}\.gz -f
#     RewriteRule \.(css|ics|js|json|html|svg)$ %{REQUEST_URI}.gz [L]

#     # Prevenir mod_deflate double gzip
#     RewriteRule \.gz$ - [E=no-gzip:1]

#     <FilesMatch "\.gz$">

#         # Sirve tipos de contenido correctos
#         <IfModule mod_mime.c>
#             # (1)
#             RemoveType gz

#             # Sirve tipos de contenido correctos
#             AddType text/css              css.gz
#             AddType text/calendar         ics.gz
#             AddType text/javascript       js.gz
#             AddType application/json      json.gz
#             AddType text/html             html.gz
#             AddType image/svg+xml         svg.gz

#             # Sirve el juego de caracteres correcto
#             AddCharset utf-8 .css.gz \
#                              .ics.gz \
#                              .js.gz \
#                              .json.gz
#         </IfModule>

# # Forzar proxies para almacenar en caché los archivos con gzip y sin gzip por separado
# # Encabezado anexar Variar Aceptar-Codificar

#     </FilesMatch>

#     # Sirve el tipo de codificación correcto
#     AddEncoding gzip .gz

# </IfModule>

# ----------------------------------------------------------------------
# | Transformación de contenido                                        |
# ----------------------------------------------------------------------

# Impedir cachés intermedios o proxies (p. Ej .: como los que están
# utilizado por los proveedores de redes móviles) de modificar el sitio web
# contenido.
#
# https://tools.ietf.org/html/rfc2616#section-14.9.5
#
# (!) Si está utilizando `mod_pagespeed`, tenga en cuenta que la configuración
# el encabezado de respuesta `Cache-Control: no-transform` evitará
# `PageSpeed` de la reescritura de archivos` HTML`, y, si
# `Directiva ModPagespeedDisableRewriteOnNoTransform` no está configurada
# a `off`, también de la reescritura de otros recursos.
#
# https://developers.google.com/speed/pagespeed/module/configuration#notransform

# <IfModule mod_headers.c>
#     Header merge Cache-Control "no-transform"
# </IfModule>

# ----------------------------------------------------------------------
# | ETags                                                              |
# ----------------------------------------------------------------------

# Quite `ETags` ya que los recursos se envían con encabezados de futuro lejano.
#
# https://developer.yahoo.com/performance/rules.html#etags
# https://tools.ietf.org/html/rfc7232#section-2.3

# `FileETag None` doesn't work in all cases.
<IfModule mod_headers.c>
    Header unset ETag
</IfModule>

FileETag None

# ----------------------------------------------------------------------
# | Caduca los encabezados                                             |
# ----------------------------------------------------------------------

# Servir recursos con un futuro lejano expira encabezados.
#
# (!) Si no controla el control de versiones con nombre de archivo
# prevención de la memoria caché, debería considerar reducir los tiempos de caché
# a algo así como una semana.
#
# https://httpd.apache.org/docs/current/mod/mod_expires.html

<IfModule mod_expires.c>

    ExpiresActive on
    ExpiresDefault                                      "access plus 1 month"

  # CSS

    ExpiresByType text/css                              "access plus 1 week"


  # Intercambio de datos

    ExpiresByType application/atom+xml                  "access plus 1 hour"
    ExpiresByType application/rdf+xml                   "access plus 1 hour"
    ExpiresByType application/rss+xml                   "access plus 1 hour"

    ExpiresByType application/json                      "access plus 0 seconds"
    ExpiresByType application/ld+json                   "access plus 0 seconds"
    ExpiresByType application/schema+json               "access plus 0 seconds"
    ExpiresByType application/vnd.geo+json              "access plus 0 seconds"
    ExpiresByType application/xml                       "access plus 0 seconds"
    ExpiresByType text/calendar                         "access plus 0 seconds"
    ExpiresByType text/xml                              "access plus 0 seconds"


# Favicon (no se puede cambiar el nombre!) Y las imágenes del cursor

    ExpiresByType image/vnd.microsoft.icon              "access plus 1 week"
    ExpiresByType image/x-icon                          "access plus 1 week"

  # HTML

    ExpiresByType text/html                             "access plus 0 seconds"


  # JavaScript

    ExpiresByType application/javascript                "access plus 1 month"
    ExpiresByType application/x-javascript              "access plus 1 month"
    ExpiresByType text/javascript                       "access plus 1 month"


  # Manifest files

    ExpiresByType application/manifest+json             "access plus 1 week"
    ExpiresByType application/x-web-app-manifest+json   "access plus 0 seconds"
    ExpiresByType text/cache-manifest                   "access plus 0 seconds"


  # Markdown

    ExpiresByType text/markdown                         "access plus 0 seconds"


  # Media files

    ExpiresByType audio/ogg                             "access plus 1 month"
    ExpiresByType image/bmp                             "access plus 1 month"
    ExpiresByType image/gif                             "access plus 1 month"
    ExpiresByType image/jpeg                            "access plus 1 month"
    ExpiresByType image/png                             "access plus 1 month"
    ExpiresByType image/svg+xml                         "access plus 1 month"
    ExpiresByType image/webp                            "access plus 1 month"
    ExpiresByType video/mp4                             "access plus 1 month"
    ExpiresByType video/ogg                             "access plus 1 month"
    ExpiresByType video/webm                            "access plus 1 month"


  # WebAssembly

    ExpiresByType application/wasm                      "access plus 1 month"


  # Web fonts

    # Collection
    ExpiresByType font/collection                       "access plus 1 month"

    # Embedded OpenType (EOT)
    ExpiresByType application/vnd.ms-fontobject         "access plus 1 month"
    ExpiresByType font/eot                              "access plus 1 month"

    # OpenType
    ExpiresByType font/opentype                         "access plus 1 month"
    ExpiresByType font/otf                              "access plus 1 month"

    # TrueType
    ExpiresByType application/x-font-ttf                "access plus 1 month"
    ExpiresByType font/ttf                              "access plus 1 month"

    # Web Open Font Format (WOFF) 1.0
    ExpiresByType application/font-woff                 "access plus 1 month"
    ExpiresByType application/x-font-woff               "access plus 1 month"
    ExpiresByType font/woff                             "access plus 1 month"

    # Web Open Font Format (WOFF) 2.0
    ExpiresByType application/font-woff2                "access plus 1 month"
    ExpiresByType font/woff2                            "access plus 1 month"


  # Other

    ExpiresByType text/x-cross-domain-policy            "access plus 1 week"

</IfModule>

# ----------------------------------------------------------------------
# | Concatenación de archivos                                          |
# ----------------------------------------------------------------------

# Permitir la concatenación desde archivos específicos.
#
# p.ej.:
#
# Si tiene las siguientes líneas en un archivo llamado, para
# ejemplo, `main.combined.js`:
#
# <! - # include file = "js / jquery.js" ->
# <! - # include file = "js / jquery.timer.js" ->
#
# Apache reemplazará esas líneas con el contenido de la
# archivos especificados

# <IfModule mod_include.c>
#     <FilesMatch "\.combined\.js$">
#         Options +Includes
#         AddOutputFilterByType INCLUDES application/javascript \
#                                        application/x-javascript \
#                                        text/javascript
#         SetOutputFilter INCLUDES
#     </FilesMatch>
#     <FilesMatch "\.combined\.css$">
#         Options +Includes
#         AddOutputFilterByType INCLUDES text/css
#         SetOutputFilter INCLUDES
#     </FilesMatch>
# </IfModule>

# ----------------------------------------------------------------------
# | Revestimiento de caché basado en nombre de archivo                 |
# ----------------------------------------------------------------------

# Si no está utilizando un proceso de compilación para administrar su versión de nombre de archivo
# revoluciones, es posible que desee considerar habilitar las siguientes directivas
# para enrutar todas las solicitudes, como `/ style.12345.css` a` / style.css`.
#
# Comprender por qué esto es importante e incluso una mejor solución que
# usando algo como `* .css? v231`, por favor mira:
# http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/

# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteCond %{REQUEST_FILENAME} !-f
#     RewriteRule ^(.+)\.(\d+)\.(bmp|css|cur|gif|ico|jpe?g|m?js|png|svgz?|webp|webmanifest)$ $1.$3 [L]
# </IfModule>

